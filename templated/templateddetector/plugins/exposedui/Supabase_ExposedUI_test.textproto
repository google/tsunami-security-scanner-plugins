# proto-file: proto/templated_plugin_tests.proto
# proto-message: TemplatedPluginTests

config: {
  tested_plugin: "Supabase_ExposedUI"
}

tests: {
  name: "whenVulnerable_returnsTrue"
  expect_vulnerability: true

  mock_callback_server: {
    enabled: true
    has_interaction: true
  }

  mock_http_server: {
    mock_responses: [
      {
        uri: "/api/platform/pg-meta/default/query?key="
        status: 200
        body_content: '[{"filename":"' '[]'
        condition: {
          headers: [
            { name: "Content-Type" value: "application/json" }
          ]
        }
      },
      {
        uri: "/project/default"
        status: 200
        body_content: "<title data-next-head=\"\">Supabase</title>"
      }
    ]
  }
}

tests: {
  name: "whenNoCallback_returnsFalse"
  expect_vulnerability: false

  mock_callback_server: {
    enabled: true
    has_interaction: false
  }

  mock_http_server: {
    mock_responses: [
      {
        uri: "/api/platform/pg-meta/default/query?key="
        status: 200
        body_content: '[{"filename":"' '[]'
        condition: {
          headers: [
            { name: "Content-Type" value: "application/json" }
          ]
        }
      },
      {
        uri: "/project/default"
        status: 200
        body_content: "<title data-next-head=\"\">Supabase</title>"
      }
    ]
  }
}

tests: {
  name: "whenNotSupabase_returnsFalse"
  expect_vulnerability: false

  mock_callback_server: {
    enabled: true
    has_interaction: true
  }

  mock_http_server: {
    mock_responses: [
      {
        uri: "TSUNAMI_MAGIC_ANY_URI"
        status: 200
        body_content: "Hello world"
      }
    ]
  }
}
